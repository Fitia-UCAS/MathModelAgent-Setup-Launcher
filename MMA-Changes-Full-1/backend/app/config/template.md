<table style="border-collapse: collapse; width: 8cm; margin: 2cm auto 0;">
  <tr>
    <td style="border:1pt solid;padding:6pt 10pt;text-align:center;">队伍编号</td>
    <td style="border:1pt solid;padding:6pt 10pt;text-align:center;">CU12341234</td>
  </tr>
  <tr>
    <td style="border:1pt solid;padding:6pt 10pt;text-align:center;">题号</td>
    <td style="border:1pt solid;padding:6pt 10pt;text-align:center;">B</td>
  </tr>
</table>
# 老城街区“平移置换”:居民搬迁多目标优化模型与决策探讨

<div style='height:2mm;'></div>
<center><div style="font-family:华文楷体;font-size:14pt;">你的名字，12345678909 （学号）</div></center>
<center><span style="font-family:华文楷体;font-size:9pt;line-height:9mm">浙江大学***** (单位)</span></center>

<div>
<div style="width:52px;float:left; font-family:方正公文黑体;">摘　要：</div> 
<div style="overflow:hidden; font-family:华文楷体;">
<p style="margin-bottom: 0.25em;">
本论文针对中国老城区更新中居民搬迁优化问题，提出了一套创新的搬迁补偿模型与优化方法，旨在腾空完整共生院落以促进开发，同时兼顾文化传承与居民生活品质。研究以113位居民和484个地块为对象，在2600万元预算约束下，通过综合考虑地块的物理属性（如面积、采光、修缮需求）和社会经济因素（如空间布局、交通便利性），实现了搬迁方案的最优解。
</p>
<p style="margin-bottom: 0.25em;">
在搬迁补偿模型的构建中，我们首先设计了硬性条件筛选算法，以地块面积、采光条件（基于朝向评分）和修缮需求作为核心约束，快速筛选出满足基本要求的候选搬迁方案（记为候选A）。针对候选A数量不足的情况，我们进一步提出了修缮补偿激励机制，通过量化修缮成本并动态调整补偿参数，对面积或采光不足的地块（记为候选B）进行补充优化。这一机制不仅扩大了可选方案的覆盖范围，还通过在开发商成本与居民满意度之间寻找平衡点，显著提高了搬迁的可行性。
</p>
<p style="margin-bottom: 0.25em;">
为了提升搬迁方案的科学性和综合性，我们开发了空间因素分析算法，利用图像识别技术从老城街区地块图示中提取关键空间信息。具体方法包括：通过HSV颜色空间转换和KMeans聚类算法，识别街道分布和房屋密度，进而计算地块的归一化交通分数（基于到街道的最小距离）和邻近分数（基于周边房屋数量）。这些空间因素被整合进搬迁补偿模型，使方案不仅局限于物理属性，还充分反映了地块的社会经济价值。
</p>
<p style="margin-bottom: 0.25em;">
在优化阶段，我们设计了一个线性规划模型，目标函数设定为最大化腾空院落数量、连通性（通过邻接矩阵衡量毗邻性）和总面积，同时最小化搬迁次数。为实现资源高效分配，我们采用了匈牙利算法，在2600万元预算内匹配113位居民与候选地块，最终生成经济性与可操作性兼备的搬迁方案。此外，我们引入了成本效益分析算法，通过模拟不同预算水平（从0至最大成本）下的优化结果，计算十年租金增量与投入的性价比（定义为m值，单位为元/元）。基于m值的曲线分析，我们识别出最佳投资点。
</p>
<p style="margin-bottom: 0.25em;">
为支持搬迁方案的实施与动态调整，我们开发了一个模块化决策支持软件框架，集成了数据管理、模型计算和可视化功能。该框架允许用户交互式调整参数（如预算、修缮权重、交通权重等），并通过matplotlib和seaborn库生成可视化结果，包括腾空院落分布图、性价比曲线和租金增量图。
</p>
<p style="margin-bottom: 0.25em;">
本研究的创新性在于多维度搬迁补偿模型的构建，将传统物理属性与空间社会经济因素相结合，通过图像识别技术弥补了空间信息量化的不足。优化算法的高效性（线性规划与匈牙利算法的结合）确保了在有限预算下的目标最大化，而成本效益分析和决策支持系统的引入则为决策者提供了直观、科学的依据。
</p>
</div>
</div>

<div>
<div style="width:52px;float:left; font-family:方正公文黑体;">关键词：</div> 
<div style="overflow:hidden; font-family:华文楷体;">
居民搬迁优化；搬迁补偿模型；图像识别；空间因素分析；线性规划；匈牙利算法；决策支持系统
</div>
</div>
<!-- 注释语句：导出PDF时会在这里分页 -->

<div style="page-break-after: always;"></div>

<!-- 注释语句：导出PDF时会在这里分页 -->

[TOC]

<div style="page-break-after: always;"></div>

## 问题提出

### 问题背景

随着我国城镇化从“增量扩张”进入“存量更新”阶段，老城平房“四合院”因产权复杂、历史保护等因素难以整体改造，形成107个杂院中“居民留居+空房并存”的“共生院”格局。规划部门提出在同一街区内“平移置换”居民，把113户在住居民集中到少数杂院，腾出连续整院，以提升开发价值并兼顾文化传承与居民原址生活品质。

### 问题重述

#### 问题一重述：搬迁补偿建模

在附件1的484块地块中，对113位居民的搬迁补偿建模需满足三大硬约束：  

​      1.迁入地块面积须满足 $A_{\text{old}} \le A_{\text{new}} \le 1.3 A_{\text{old}}$  

​      2.迁入地块朝向不可劣于原地块，采光等级为南 = 北 > 东 > 西  

​      3.如有必要，修缮补偿最高不超过 20 万元  

基于此，为每户计算其“面积–采光–修缮”补偿区间，并综合考虑附加因素（如地块与街道的距离、周围房屋密度）对搬迁补偿的影响，生成所有可能的搬迁补偿方案。除了上述硬性条件外，还需考虑图1、图2中展示的其他影响因素。特别是图2展示了老城街区的地块分布、邻近关系情况，这些因素在补偿方案的制定中应被综合考虑。例如，地块之间的毗邻关系会影响完整院落的开发效益，进而影响搬迁补偿的计算，因此需要在模型中综合评估这些因素。

#### 问题二重述：整院面积最大化搬迁决策建模

在问题一给出的“面积–采光–修缮”可行域内，为 113 户居民确定迁入地块，使腾空的完整院落数量最多且相互毗邻，在此基础上进一步追求腾空总面积最大并尽量减少搬迁户数。整个搬迁投入须控制在 2000 万元的保底成本＋不超过 600 万元备用金之内，成本项包括每户 3 万元的沟通协调费、最高 20 万元/户的修缮费、因面积补偿带来的租金折算损失以及迁出/迁入地块各停租 4 个月的租金损失。  

收益方面，散户出租按东西厢 8 $元/m^3$·天、南北厢 15 $元/m^3$·天计算，整院出租为 30 $元/m^3$·天，毗邻整院出租单价再上浮 20%，并以十年期租金收入进行测算。最终输出每户的迁出—迁入地块对应关系、腾空整院编号及面积、总成本、十年期租金收入与净收益。租金标准计算：南北厢 15 元/平米/天，东西厢 8 元/平米/天，总投入控制在保底 2000 万元 + 备用金 $\le$ 600 万元内。

#### 问题三重述：性价增益拐点建模

结合问题一搬迁补偿模型、问题二整院面积最大化搬迁决策模型、问题三性价增益拐点模型，设计老城区平移置换决策软件的框架。设计过程中，指出设计框架中的人工输入参数，如何通过软件完成可视化的问题二和问题三的智能计算。

## 问题分析

### 对于问题一的分析

在设计搬迁补偿模型时，首先需要对附件1中的 484 块地块数据进行筛选与处理。数据包括地块 ID、院落 ID、面积、院落总面积、朝向和是否有住户等信息，数据完整无缺失或异常，可直接依据硬性约束筛选符合条件的地块。  

具体来说，针对每个居民（共 113 户），需选择适合的迁入地块，确保满足以下三大约束：  

​      1.**面积条件**：迁入地块面积必须满足 $A_{old} \le A_{new} \le 1.3 A_{old}$，即新地块面积在原地块面积的 1.0 到 1.3 倍之间。  

​      2.**朝向条件**：迁入地块的朝向不应劣于原地块，朝向等级为南 = 北 > 东 > 西。可为每个朝向赋予数值（如南、北为 2，东、西为 1），确保新地块的数值不低于原地块。  

​      3.**修缮条件**：若面积和朝向条件不能完全满足，可提供修缮补偿，最高 20 万元，用于翻新或改善地块条件。  

除了硬性约束，居民搬迁补偿还需考虑附加因素：  

​      1.**距离到街道**：迁入地块与街道的距离 $d_n$ 会影响补偿。距离较近的地块交通便利，通常更受欢迎；距离较远的地块可能因交通不便需额外补偿。  

​      2.**周围房屋密度**：地块周围的房屋密度 $\rho_n$ 影响居民的舒适感。密度较高的区域因社区氛围更强而受欢迎，密度较低的区域可能需补偿。  

​      3.**心理价位**：居民的心理价位也是其中的重要一环。如果所迁入地块价位较低，通常居民会不愿意搬迁，需要考虑这部分的额外补偿。  

​      4.**居住舒适度**：迁入地块的居住舒适度也是需要考虑的因素，如果舒适度不佳，需要考虑这部分的额外补偿。  

通过综合考虑这些因素，为每个居民确定最合适的“面积–采光–修缮”补偿区间，并进一步定量分析附加因素的影响。

### 对于问题二的分析

在问题一确立的“面积–采光–修缮”可行域内，我们的任务是为 113 位居民设计搬迁方案。首要目标是最大化腾空的完整院落数量，并优先选择相互毗邻的院落以提升收益潜力，其次是最大化腾空的总面积，同时尽量减少搬迁户数以降低成本并提高执行效率。  

为此，我们首先使用匈牙利算法为每位居民匹配合适的迁入地块，生成候选搬迁方案，确保新地块满足面积（不小于原面积且不超过 1.3 倍）、采光（不劣于原朝向，排序为南/北 > 东/西）和修缮补偿（每户 0 至 20 万元）的要求。  

随后，通过线性规划优化整体搬迁方案，分配不同的权重实现多目标优化：最大化腾空院落数量，优化毗邻程度、腾空面积，并尽量减少搬迁户数。搬迁成本包括每户 3 万元的沟通协调费、灵活设置的修缮费、基于租金标准（南/北 15 元/$m^3$·天，东/西 8 元/$m^3$·天）的面积补偿损失，以及迁出和迁入地块各 4 个月的停租损失。预算上限为 2600 万元（2000 万元保底成本＋600 万元备用金），我们通过线性规划在预算内优化方案。  

在收益方面，我们考虑毗邻效应对租金收入的提升作用：相邻的空置院落可使整院出租收益在 30 元/㎡·天的基础上上浮 20%，而散租则按朝向分别为 8 元/㎡·天或 15 元/㎡·天，均以十年期测算。通过加权线性规划，我们制定出既能控制成本、满足居民需求，又能提升长期收益的搬迁方案。输出内容包括每户居民的迁出迁入地块、腾空院落详情、总成本和净收益，确保全面满足问题的多目标需求。

### 对于问题三的分析

问题三的核心是分析搬迁过程中的性价增益拐点，即计算十年累计租金增量与实际搬迁投入之比 $m \geq 20$，其中，$m = \text{十年累计租金增量} / \text{实际搬迁投入}$

我们将通过计算每个搬迁方案的租金增量与投入的比率，追踪这一比率随搬迁进程的变化。如果在某一阶段，继续搬迁导致性价比下降，我们需要确定这个拐点，并分析其出现的原因和搬迁组合。例如，哪些院子的居民从哪个地块搬到哪个地块，腾空的整院面积是多少，以及最终的成本和收益如何。如果没有出现拐点，我们将进一步探讨如何调整阈值 $m$，并通过前后差分计算找出性价比下降的临界点。

### 对于问题四的分析

为了设计一个能够智能计算老城区平移置换决策的软件框架，从系统需求、通用性、可扩展性和易用性出发，对搬迁补偿模型、整院面积最大化搬迁决策模型以及性价增益拐点模型进行进一步分析，首先考虑 **输入参数模块** 要全面覆盖所有决策所需信息，包括地块属性（院落编号、面积、朝向、空置状态）、居民补偿偏好（对面积、采光、修缮的最低接受阈值）、以及预算和成本参数（保底资金、备用金比例、沟通和修缮费用标准、停租损失标准等）。

## 模型假设

**假设 1**：地块分类与房屋颜色一致。在图像处理阶段，居住房屋和空闲房屋的颜色区分明确，分别对应深红色和浅红色区域。所有房屋的颜色在模型求解过程中不发生变化。 
**合理性**：图像预处理中的颜色提取基于稳定的视觉特征，且颜色与房屋使用状态（居住或空置）直接相关。

**假设 2**：地块面积与采光分数稳定。每个地块的面积和采光分数在单次决策周期内保持不变。
**合理性**：假设基于长期的实地数据和调研结果，确保在短期内补偿方案的一致性与可比性。

**假设 3**：补偿计算基于历史数据与配置文件。所有补偿参数（如面积补偿、采光补偿、修缮补偿等）均通过配置文件提供，并依据历史数据进行标准化计算。所有计算使用的参数保持固定，除非配置文件发生更改。
**合理性**：该假设有助于简化计算模型，通过统一配置确保计算的一致性和可靠性。

**假设 4**：房屋与街道的最小距离与交通分数影响补偿金额。房屋与街道之间的最小距离以及周围房屋的临近分数直接影响到补偿金额，特别是在交通和布局补偿的计算中起到关键作用。
**合理性**：该假设基于交通便利性对居民生活质量的影响，利用归一化的距离和临近分数进行补偿调整。

**假设 5**：房屋类型和地块的原始状态相互影响。补偿的计算不仅依赖于地块的基本特征（如面积和采光分），还考虑到原始状态（如是否为居民用地）对补偿策略的影响。
**合理性**：补偿的合理性通过综合评估地块的初始状态和邻近环境来保证与实际搬迁需求相符。

**假设 6**：所有计算基于标准化数据进行。地块面积、采光分数、交通分数和舒适度分数等所有影响补偿的因素都会进行标准化处理，使得不同地块之间具有可比性，并能够合理地进行补偿金额的估算。
**合理性**：数据标准化保证了各地块间的补偿计算公正，并为进一步的模拟和优化提供了统一的尺度。

**假设 7**：所有补偿项目的权重固定。在补偿模型中，每个因素（如面积、采光、修缮、交通等）的权重值均由配置文件设定，并在整个模型过程中保持不变。
**合理性**：该假设确保了补偿计算中的稳定性和可重复性，有助于简化计算模型，避免频繁调整权重。

## 符号说明

| 符号                      | 含义                                                         |
| ------------------------- | ------------------------------------------------------------ |
| $A_{old}$             | 原地块面积（㎡）                                             |
| $A_{new}$             | 迁入地块面积（㎡）                                           |
| $x_{h,n}$                 | 居民 $h$ 迁入地块 $n$ 的二进制决策变量，$x_{h,n}\in\{0,1\}$  |
| $y_{k}$                   | 杂院 $k$ 是否被腾空的二进制变量，$y_k\in\{0,1\}$             |
| $S_{k}$                   | 杂院 $k$ 的可用空置总面积（㎡）                              |
| $A_{k\ell}$               | 院落 $k$ 与院落 $\ell$ 的毗邻关系（1：毗邻，0：不毗邻）      |
| $r_{n}$                   | 地块 $n$ 的基础日租金（元/㎡·天），取值为8或15               |
| $c^{comm}$            | 每户搬迁沟通协调费（万元），当前为3                          |
| $c_{h}^{reno}$        | 居民 $h$ 的修缮补偿费用（万元）                              |
| $c_{h}^{area}$        | 居民 $h$ 因面积补偿多补面积导致的租金折算损失（万元）        |
| $c_{h}^{time}$        | 居民 $h$ 的停租损失（万元），包括迁出与迁入各4个月停租损失   |
| $d_{n}$                   | 地块 $n$ 到街道的距离（米）                                  |
| $\rho_{n}$                | 地块 $n$ 周边的房屋密度（户/㎡）                             |
| $\theta_{h}^{A}$          | 居民 $h$ 对面积补偿的最低接受比例阈值                        |
| $\theta_{h}^{P}$          | 居民 $h$ 对采光等级的最低接受阈值                            |
| $\theta_{h}^{R}$          | 居民 $h$ 对修缮补偿的最高接受金额阈值（万元）                |
| $B_{base}$            | 保底成本上限（万元），当前为2000                             |
| $B_{reserve}$         | 备用金上限（万元），当前为600                                |
| $Z_{1},Z_{2},Z_{3},Z_{4}$ | 分阶段目标函数值，分别对应腾空院落数、毗邻度、腾空总面积和搬迁户数 |
| $m$                       | 十年累计租金增量与实际搬迁投入之比                           |
| $m_{t}$                   | 第 $t$ 步搬迁后的性价比值                                    |

## 模型建立与求解

### 问题一：搬迁补偿模型的建立与求解

#### 解题思路

问题一要求我们设计搬迁补偿模型，鉴于题目所提供的附件一数据完整且无缺失或错误，因此无需进行数据处理。首先需要加载附件中的484条数据，数据内容包括地块ID、院落ID、院落面积、总面积、朝向以及是否存在住户等基本信息。随后，需进一步考虑附加因素，这些因素包括：地块与街道的最短距离、周围房屋的密度以及地块的临近关系等。通过这些附加条件，我们将评估它们对居民搬迁决策的潜在影响。

鉴于后续数据处理中需要使用图像识别信息，首先必须对图像进行识别，并提取其他附加信息，包括房屋坐标信息（分为正在居住的房屋坐标以及空闲房屋的坐标）、院落的坐标信息、街道的坐标信息。为此，我们使用`OpenCV`库进行图像识别，依据不同的颜色分类自动提取图像中的坐标数据，在此之后依据所提取的坐标数据进行一定的计算实现不同指标的打分以及归一化打分。在这个归一化打分的基础上分别给每个打分配以不同的权重或相同的权重综合起来实现搬迁补偿模型的建立。

#### 模型建立

以下是针对搬迁补偿建模中“模型建立”部分的完整阐述。该模型综合考虑了硬性约束（面积、采光、修缮）和附加因素（如地块与街道距离、周围房屋密度等），为老城街区改造中113位居民的搬迁补偿方案提供科学依据。

1. 图像识别与数据提取 
   搬迁补偿建模的第一步是从图像中提取地块的关键地理信息，包括居住房屋、空闲房屋、院落和街道的位置，为后续的空间分析和补偿计算奠定基础。

    1. 图像识别与坐标提取 
   使用 OpenCV 加载老城街区图像，并将其从 RGB 色彩空间转换为 HSV 色彩空间，以适应光照变化并进行颜色分割。通过配置文件预定义的 HSV 范围（深红色为居住房屋，浅红色为空闲房屋，绿色为院落），生成掩模提取特定区域。对每个掩模进行轮廓检测，过滤面积小于阈值的噪声轮廓，计算边界矩形中心点坐标，得到居住房屋、空闲房屋和院落的代表位置。

   2. 聚类处理 
   为优化坐标精度，使用 K-Means 聚类算法处理提取的坐标点，聚类数量由配置文件指定（居住房屋 113 个，空闲房屋 371 个，院落 107 个）。聚类中心点作为最终位置，并在原图像上标记（居住房屋绿色圆点，空闲房屋蓝色圆点，院落黄色圆点），生成可视化图像（验证效果）。

   3. 街道定位 
   将图像转为灰度图，通过阈值处理，提取白色街道区域，获取像素坐标用于后续距离计算。

   4. 附加指标计算 
   计算房屋临近分数：用欧几里得距离统计距离阈值内的附近房屋数量，归一化为$\text{归一化临近分数} = \text{附近房屋数量} / \text{最大附近房屋数量}$
   临近分数越高表明附近房屋数量越多，邻居越多。

   $\text{归一化临近分数} = text{附近房屋数量} / \text{最大附近房屋数量}$
   临近分数越高表明附近房屋数量越多，邻居越多。

   计算交通分数：根据房屋到街道的最小距离，归一化为$\text{归一化交通分数} = 1 - \text{最小距离} / \text{最大距离}$

   交通分数越高，表明地块交通便利性越好。

   5. 数据保存 
      将坐标、临近分数和交通分数保存为 CSV 文件支持后续计算。

2. 硬因素补偿建模

    硬因素补偿基于面积、采光和修缮三大约束，针对 113 位居民和 371 块空置地块计算补偿区间。

    1. 数据准备

        从 `Sheet1.csv` 加载 484 块地块数据（含地块 ID、院落 ID、面积、朝向、是否有住户等），分为在住地块（113 块）和空置地块（371 块）。根据朝向赋值采光分（南、北为 2，东、西为 1）。

    2. 补偿计算

        为每位居民遍历空置地块，筛选满足硬性约束的候选地块，计算补偿：

        1. 面积补偿

            新地块面积需满足：

            $$
            A_{\text{old}} \le A_{\text{new}} \le 1.3 A_{\text{old}}
            $$

            若 $A_{\text{new}} > A_{\text{old}}$，则：

            $$
            \text{面积补偿}_{\text{min}} = (A_{\text{new}} - A_{\text{old}}) \times \text{每平米补偿}_{\text{min}}
            $$

            $$
            \text{面积补偿}_{\text{max}} = (A_{\text{new}} - A_{\text{old}}) \times \text{每平米补偿}_{\text{max}}
            $$

            补偿比例从配置文件读取。

        2. 采光补偿

            新地块采光分不得低于原地块，若更高，则：

            $$
            \text{采光补偿}_{\text{min}} = (\text{采光分}_{\text{new}} - \text{采光分}_{\text{old}}) \times \text{每采光分补偿}_{\text{min}}
            $$

            $$
            \text{采光补偿}_{\text{max}} = (\text{采光分}_{\text{new}} - \text{采光分}_{\text{old}}) \times \text{每采光分补偿}_{\text{max}}
            $$

            否则补偿为 0。

        3. 修缮补偿

            若新地块面积或采光劣于原地块，计算修缮补偿（上限 20 万元）：

            $$
            \text{修缮补偿}_{\text{min}} = (\text{面积差异} \times \text{每平米修缮费用}_{\text{min}}) + (\text{采光差异} \times \text{每采光分修缮费用}_{\text{min}})
            $$

            $$
            \text{修缮补偿}_{\text{max}} = (\text{面积差异} \times \text{每平米修缮费用}_{\text{max}}) + (\text{采光差异} \times \text{每采光分修缮费用}_{\text{max}})
            $$

    3. 总成本

        $$
        \text{总成本}_{\text{min}} = \text{面积补偿}_{\text{min}} + \text{采光补偿}_{\text{min}} + \text{修缮补偿}_{\text{min}}
        $$

        $$
        \text{总成本}_{\text{max}} = \text{面积补偿}_{\text{max}} + \text{采光补偿}_{\text{max}} + \text{修缮补偿}_{\text{max}}
        $$

        $$
        \text{总成本}_{\text{avg}} = (\text{总成本}_{\text{min}} + \text{总成本}_{\text{max}})/2
        $$

    4. 数据保存

	所有结果保存为 `all_compensations.csv` 文件，包含原地块 ID、候选地块 ID、各类补偿（面积、采光、修缮）以及总成本（最小值、最大值、平均值）。

3. 其他因素补偿建模
   模型进一步考虑布局、交通、心理价位和住宿舒适度等软因素，优化补偿方案。

   1. 数据准备

   将图像识别的坐标、临近分数和交通分数分配到地块数据框。对院落面积、地块面积和采光分标准化：
   $$
   \text{标准化值} = \frac{\text{当前值} - \text{最小值}}{\text{最大值} - \text{最小值}}
   $$
   
   采光分标准化为 `(采光分 - 1) / 2`。心理价位分数以标准化院落面积表示，舒适度分数为：
   
   $$
   \text{舒适度分数} = (\text{标准化地块面积} + \text{标准化采光分} + \text{归一化交通分数})/3
   $$
   
   2. 补偿计算
      基于软因素差异计算额外补偿：
   
      1. 布局补偿
         若新地块临近分数低于原地块，
         $$
         \text{布局补偿} = (\text{临近分数}_{\text{old}} - \text{临近分数}_{\text{new}}) \times \text{布局补偿权重}
         $$
         
      2. 交通补偿
         若新地块交通分数低于原地块，
         $$
         \text{交通补偿} = (\text{交通分数}_{\text{old}} - \text{交通分数}_{\text{new}}) \times \text{交通补偿权重}
         $$
         
      3. 心理价位补偿
         若新地块心理价位分数低于原地块，
      
         $$
         \text{心理价位补偿} = (\text{心理价位分数}_{\text{old}} - \text{心理价位分数}_{\text{new}}) \times \text{心理补偿权重}
         $$
      
      4. 舒适度补偿
         若新地块舒适度分数低于原地块，
      
         $$
         \text{舒适度补偿} = (\text{舒适度分数}_{\text{old}} - \text{舒适度分数}_{\text{new}}) \times \text{舒适度补偿权重}
         $$
      
      更新总成本：
      
      $$
      \text{总成本}_{\text{min/max}} += \text{布局补偿} + \text{交通补偿} + \text{心理价位补偿} + \text{舒适度补偿}
      $$
      
      $$
      \text{总成本}_{\text{avg}} = (\text{总成本}_{\text{min}} + \text{总成本}_{\text{max}})/2
      $$
   
4. 综合补偿模型

   1. 补偿汇总
      合并硬因素和软因素补偿，生成包含原地块ID、候选地块ID及各补偿项的数据框。筛选条件：面积 $A\_{\text{old}} \le A\_{\text{new}} \le 1.3 A\_{\text{old}} $、采光分不低于原地块、修缮补偿不超过20万元。

   2. 结果保存与可视化
      综合数据保存为 `all_compensations_re.csv`，并通过图表（如柱状图或散点图）展示补偿区间，辅助决策。

#### 求解步骤

1. 图像识别提取关键信息
	1. 图像识别与坐标提取

	图像识别中，HSV色彩空间（Hue, Saturation, Value）比RGB色彩空间更适合颜色分割，因为HSV将颜色信息（Hue）与亮度和饱和度分离，能够更好地处理光照变化。我们通过设定HSV中的Hue、Saturation和Value的范围来提取特定颜色的区域。

	HSV色彩空间的转换公式为：

   $$
    H = \begin{cases}
    0^\circ & \text{if } \max = \min \\
    60^\circ \times \left( \frac{G - B}{\max - \min} \right) + 0^\circ & \text{if } \max = R \text{ and } G \geq B \\
    60^\circ \times \left( \frac{G - B}{\max - \min} \right) + 360^\circ & \text{if } \max = R \text{ and } G < B \\
    60^\circ \times \left( \frac{B - R}{\max - \min} + 2 \right) & \text{if } \max = G \\
    60^\circ \times \left( \frac{R - G}{\max - \min} + 4 \right) & \text{if } \max = B
    \end{cases}
   $$

   $$
    S = \begin{cases}
    0 & \text{if } \max = 0 \\
    \frac{\max - \min}{\max} & \text{otherwise}
    \end{cases}
   $$

   $$
    V = \max
   $$

	其中，$R, G, B$ 是图像的红、绿、蓝分量。通过设定HSV的上下界，我们可以生成一个掩模（mask），用于提取特定颜色的区域：

   $$
    \text{mask} = \begin{cases}
    255 & \text{if } \text{lower} \leq \text{pixel} \leq \text{upper} \\
    0 & \text{otherwise}
    \end{cases}
   $$

   基于上述，我们使用OpenCV库进行图像处理，首先加载图像并将其转换为HSV色彩空间，便于区分不同的颜色区域。通过设定特定的色彩范围，我们可以提取图像中代表“居住房屋”和“空闲房屋”的区域。我们分别提取了深红色区域（居住房屋）和浅红色区域（空闲房屋）中的坐标信息。每个房屋的坐标由其中心点的像素坐标表示。

	![图1 老城街区地块](assets/original_image.jpg)

	2. 房屋坐标聚类处理

	为了去除噪声并优化坐标数据，确保每个地块或院落的定位精度，我们对提取到的房屋坐标进行了聚类处理。通过K-Means聚类算法，将居住房屋（113个）、空闲房屋（371个）和院落坐标（107个）进行聚类，每个簇的中心点分别表示一个居住房屋近似位置、一个空闲房屋的近似位置、一个院落的近似位置。图像显示聚类效果良好，也说明了这种处理方式是可以接受的。

	K-Means的目标是最小化以下损失函数：

   $$
    J = \sum_{i=1}^{K} \sum_{x \in C_i} \| x - \mu_i \|^2
   $$

	其中，$C_i$ 是第 $i$ 个簇，$\mu_i$ 是第 $i$ 个簇的质心。

	质心的更新公式为：

   $$
    \mu_i = \frac{1}{|C_i|} \sum_{x \in C_i} x
   $$

	处理后结果如下：

	![图2 居住地块识别结果图（绿色）](assets/resident_house_clusters.jpg)

	![图3 未居住地块识别结果图（蓝色）](assets/vacant_house_clusters.jpg)

	3. 院落位置的识别与聚类

	院落位置的识别和聚类处理与房屋坐标的提取相似。通过提取图像中的绿色区域，我们成功地标记出院落的位置。然后，同样使用K-Means聚类算法对院落坐标进行处理，确保每个院落区域的定位精度。

	特别的我们用到阈值分割，处理的公式为：

   $$
    \text{dst}(x, y) = \begin{cases}
    \text{maxval} & \text{if } \text{src}(x, y) > \text{threshold} \\
    0 & \text{otherwise}
    \end{cases}
   $$

	![图4 院落识别图二值化结果](assets/land_mask.jpg)

	![图5 院落识别结果（黄色）](assets/land_clusters.jpg)

	4. 街道定位

	为了进一步分析地块的搬迁补偿情况，我们还进行了街道位置的定位。通过转换图像为灰度图并应用阈值处理，提取出图像中的街道区域。通过提取白色区域的坐标，我们能够准确定位街道的具体位置，从而为计算房屋与街道的最小距离提供数据支持。

	![图6 街道识别结果（白色）](assets/street.jpg)

	5. 计算房屋临近评分与房屋交通评分

	在提取到所有房屋的坐标后，计算每个房屋与周围其他房屋的距离，每个房屋与最近街道的距离。对于两点 $(x_1, y_1)$ 和 $(x_2, y_2)$，欧几里得距离为

   $$
    d = \sqrt{(x_2 - x_1)^2 + (y_2 - y_1)^2}
   $$

	紧接着，我们依据一定的直径范围，统计在直径范围内的房屋个数，作为房屋临近指标，令房屋直径内房屋的个数等于房屋的临近分数。接着，我们根据求得的一系列临近分数进行归一化计算以排除量纲的影响。相应的归一化规则如下：

   $$
    \text{归一化值} = \frac{\text{当前值} - \text{最小值}}{\text{最大值} - \text{最小值}}
   $$

	然后，对房屋与街道的一系列距离也做相同规则的归一化处理。据此，我们得到了临近分数、交通分数、临近归一化分数、交通归一化分数。

	6. 数据保存与可视化

	最后，所有的处理结果用pandas保存到CSV文件中，便于后续的数据分析与处理。此外，我们还对每一步的处理结果进行了可视化展示，图像分别展示了居住房屋、空闲房屋、院落以及街道的空间分布（图1、图2、图3、图4、图5、图6）。

2. 硬因素补偿
	1. 面积补偿
	面积补偿是通过计算空置地块与在住居民地块之间的面积差异来得出的。具体地，我们计算两个地块面积差异，并根据配置文件中的最小和最大补偿比例，计算出面积补偿的上下限。

	面积补偿的计算公式为：

   $$
   \text{面积补偿} = \text{面积差异} \times \text{补偿比例}
   $$

	2. 采光补偿

	采光补偿则基于每个地块的朝向（采光分数）进行计算。朝向较好（即采光分较高）的地块会获得更多的补偿。我们计算空置地块与在住居民地块之间的采光分数差异，并根据配置中的最小和最大补偿比例计算补偿。

	采光补偿的计算公式为：

   $$
    \text{采光补偿} = \text{采光分差异} \times \text{补偿比例}
   $$

	3. 修缮补偿

	修缮补偿基于地块面积和采光分差异，反映房屋的修缮需求。修缮费用也有最小和最大值，因此我们需要计算每个地块的修缮补偿范围。修缮补偿的计算包括面积差异和采光差异，公式为：

   $$
    \text{修缮补偿} = \text{面积差异} \times \text{修缮费用比例} + \text{采光差异} \times \text{修缮费用比例}
   $$

3. 其他补偿因素

    1. 数据准备

    基于归一化临近分数、归一化交通分数，我们乘以相应的权重计算出相应的补偿，将所有已知的补偿汇总起来完成数据准备。

    2. 心理价位分数

    对 **心理价位分数**，通过关键参数——归一化后的院落面积来反映心理价位的分数。一般来说，院落面积能够反映居民对地块的满意程度，也即反映了心理价位。

    3. 居住舒适度分数

    对于 **居住舒适度分数**，通过综合考虑地块面积、朝向（采光分数）以及交通分数，设计相同的权重来估计舒适度分数：
    
    $$
    \text{舒适度分数} = (\text{标准化地块面积} + \text{标准化采光分} + \text{归一化交通分})/3
    $$

4. 综合搬迁补偿模型

    结合上文的硬指标，我们接着考虑其他因素的补偿，包括布局补偿、交通补偿、心理补偿与舒适度补偿。相应的计算公式如下：

    1. 布局补偿

    布局补偿主要基于临近分数来进行评估。地块的临近性越好，其布局补偿越高。补偿公式为：

    $$
    \text{布局补偿} = \text{临近分数差异} \times \text{布局补偿权重}
    $$

    2. 交通补偿

    交通补偿根据归一化交通分数进行计算。交通越便利的地块，其交通补偿越高。补偿公式为：

    $$
    \text{交通补偿} = \text{交通分数差异} \times \text{交通补偿权重}
    $$

    3. 心理补偿

    心理补偿依据地块的心理价位分数进行计算。面积较大的地块，其心理补偿也会较高。补偿公式为：

    $$
    \text{心理补偿} = \text{心理价位分数差异} \times \text{心理补偿权重}
    $$

    4. 舒适度补偿

    舒适度补偿通过地块的舒适度分数来进行评估，舒适度较高的地块将获得更高的补偿。补偿公式为：$\text{舒适度补偿} = \text{舒适度评分差异} \times \text{舒适度补偿权重}$

4. 计算总补偿

总补偿是面积补偿、采光补偿和修缮补偿的总和。

总补偿的计算公式为：

$$
\begin{equation}
\begin{aligned}
\text{总补偿} = & \ \text{面积补偿} + \text{采光补偿} + \text{修缮补偿} \ + \\
                & \ \text{布局补偿} + \text{交通补偿} + \text{心理补偿} + \text{舒适度补偿}
\end{aligned}
\end{equation}
$$

#### 求解结果

我们将上述结果整合到一个统一的表格中，并进行可视化展示。通过图表与图像展示每个地块的补偿情况，帮助我们更直观地理解各地块的搬迁需求，并为后续补偿方案的制定提供依据。

​			                             **表1 部分结果展示**

| 原地块ID | 新地块ID | 布局补偿   | 交通补偿   | 心理价位补偿 | 住宿舒适度补偿 | 总成本_avg |
|----------|----------|------------|------------|--------------|---------------|------------|
| 3        | 1        | 6597.938   | 0.000      | 1257.778     | 846.382       | 38702.098  |
| 3        | 2        | 5463.918   | 4556.982   | 1275.556     | 1838.366      | 51134.821  |
| 3        | 4        | 0.000      | 0.000      | 0.000        | 0.000         | 21250.000  |
| 3        | 6        | 3814.433   | 4728.902   | 0.000        | 2588.746      | 39132.080  |
| 3        | 8        | 4329.897   | 0.000      | 0.000        | 1474.708      | 34554.605  |
| 3        | 10       | 5567.010   | 1612.569   | 1090.370     | 484.535       | 37754.485  |
| 3        | 11       | 5670.103   | 8146.935   | 1090.370     | 1506.632      | 36414.041  |
| 3        | 12       | 5773.196   | 7945.324   | 1090.370     | 1577.197      | 50386.087  |
| 3        | 13       | 7319.588   | 5819.254   | 1090.370     | 2755.590      | 42984.802  |
| 3        | 15       | 1855.670   | 0.000      | 1010.370     | 1632.621      | 29498.661  |

### 问题二：整院面积最大化搬迁决策模型的建立与求解

#### 解题思路

基于问题一的搬迁补偿模型，问题二旨在设计一个最优搬迁决策方案，以实现以下目标：最大化腾空的完整院落数量，优先考虑毗邻院落的连通性，最大化腾空总面积，同时尽量减少搬迁户数，并确保总成本控制在2600万元以内（包括2000万元保底成本和不超过600万元的备用金）。为此，我们采用混合整数线性规划（MILP）方法，通过数学建模和优化工具，综合考虑硬性约束（如面积、采光、修缮补偿）以及成本和收益的计算，在预算约束内制定最优搬迁方案。

解题思路包括以下关键步骤：

​      1.**数据准备**：整理地块、居民和院落的基本信息，并分析院落之间的毗邻关系。

​      2.**变量定义**：定义居民迁入地块和院落腾空的决策变量。

​      3.**目标设定**：整合多个优化目标为单一综合目标，体现优先级顺序。

​      4.**约束设计**：设置居民迁入、院落腾空、补偿要求和预算限制等约束条件。

​      5.**模型优化**：通过优化工具求解模型，得出最优搬迁方案。

​      6.**结果分析**：整理搬迁方案、腾空院落、成本和收益信息，并评估优化效果。

#### 模型建立

搬迁决策优化模型基于附件数据，包括地块的面积、朝向、租金，居民的原住信息，以及院落的分布和毗邻关系。模型通过数学优化方法，综合考虑硬性约束和多目标优化需求。

1. **决策变量**
   
   - **$x_{h,n}$**: 二进制变量，表示居民 $h$ 是否迁入地块 $n$。若迁入，则 $x_{h,n} = 1$；否则，$x_{h,n} = 0$。
   - **$y_k$**: 二进制变量，表示杂院 $k$ 是否被完全腾空。若腾空，则 $y_k = 1$；否则，$y_k = 0$。
   
2. **其他参数**
   沿用问题一中的符号定义，并补充以下参数：
   - **$A_{\text{old},h}$**: 居民 $h$ 原住地块的面积（㎡）。
   - **$A_n$**: 迁入地块 $n$ 的面积（㎡）。
   - **$r_n$**: 地块 $n$ 的基础日租金（元/㎡·天），取值为 8 或 15。
   - **$c^{\text{comm}}$**: 每户搬迁的沟通协调费用（万元），当前为 3。
   - **$c_h^{\text{reno}}$**: 居民 $h$ 的修缮补偿费用（万元），范围在 0 至 20 之间。
   - **$c_h^{\text{area}}$**: 居民 $h$ 因面积补偿导致的租金折算损失（万元）。
   - **$c_h^{\text{time}}$**: 居民 $h$ 的停租损失（万元），迁出与迁入各 4 个月。
   - **$A_{k\ell}$**: 院落 $k$ 与院落 $\ell$ 的毗邻关系（1 表示毗邻，0 表示不毗邻）。
   - **$B_{\text{base}}$**: 保底成本上限（万元），为 2000。
   - **$B_{\text{reserve}}$**: 备用金上限（万元），为 600。
   - **$S_k$**: 杂院 $k$ 的可用空置总面积（㎡），即院落 $k$ 的总面积。
   - **$\theta_h^A$**: 居民 $h$ 对面积补偿的最低接受比例阈值。
   - **$\theta_h^P$**: 居民 $h$ 对采光等级的最低接受阈值。

3. **目标函数**
   问题二为多目标优化问题，目标按优先级排序如下：
   - 最大化腾空院落数量：$\sum_k y_k$
   - 最大化毗邻程度：$\sum_k \sum_\ell A_{k\ell} y_k y_\ell$
   - 最大化腾空总面积：$\sum_k S_k y_k$
   - 最小化搬迁户数：$\sum_h \sum_n x_{h,n}$

   为整合多目标，采用加权综合方法，构造统一目标函数，权重反映优先级：
   $$
   \text{目标函数} = 10 \cdot \sum_k y_k + 5 \cdot \sum_k \sum_\ell A_{k\ell} y_k y_\ell + 0.01 \cdot \sum_k S_k y_k - 0.1 \cdot \sum_h \sum_n x_{h,n}
   $$
   权重设计确保腾空院落数量优先，毗邻连通性次之，腾空面积和搬迁户数适当考虑。

4. **约束条件**
   - **每户居民至多迁入一个地块**：
     $$
     \sum_n x_{h,n} \leq 1, \quad \forall h
     $$
   - **每个地块至多被一个居民占用**：
     $$
     \sum_h x_{h,n} \leq 1, \quad \forall n
     $$
   - **院落腾空条件**：院落 $k$ 腾空当且仅当其所有居民迁出：
     $$
     y_k \leq 1 - \sum_{h \in k} \sum_n x_{h,n}, \quad \forall k
     $$
   - **面积补偿约束**：迁入地块面积需满足：
     $$
     A_{\text{old},h} \cdot \theta_h^A \leq \sum_n A_n x_{h,n} \leq 1.3 \times A_{\text{old},h}, \quad \forall h
     $$
   - **采光补偿约束**：迁入地块采光等级不低于原地块：
     $$
     \sum_n r_n x_{h,n} \geq r_{\text{old},h} \cdot \theta_h^P, \quad \forall h
     $$
   - **修缮补偿约束**：
     $$
     0 \leq c_h^{\text{reno}} \leq \theta_h^R, \quad \forall h
     $$
   - **总成本约束**：总成本不超过 2600 万元：
     $$
     \sum_h \sum_n x_{h,n} \left( c^{\text{comm}} + c_h^{\text{reno}} + c_h^{\text{area}} + c_h^{\text{time}} \right) \leq B_{\text{base}} + B_{\text{reserve}}
     $$

   其中，面积补偿损失基于迁入地块面积超出原地块的部分，按年租金折算；停租损失按原地块面积和租金计算 8 个月损失。

5. **收益计算**
   腾空院落的收益与租金收入相关，考虑毗邻效应。基础租金为 30 元/㎡·天，若院落毗邻其他腾空院落，租金增加 20%。收益按十年期计算，公式为：
   $$
   \text{总收益} = \sum_k y_k S_k r_k \cdot 365 \cdot 10 \cdot \left(1 + 0.2 \cdot \sum_\ell A_{k\ell} y_\ell\right) / 10000
   $$

#### 求解步骤

1. **数据整理与分析**
   - 加载地块、居民和院落数据，包括面积、租金、朝向等信息。
   - 构建院落毗邻关系矩阵 $A_{k\ell}$，基于坐标或预定义数据，明确毗邻院落。

2. **建立优化模型**
   - 使用 PuLP 定义决策变量 $x_{h,n}$ 和 $y_k$。
   - 构造加权目标函数，综合腾空院落数量、毗邻性、总面积和搬迁户数。
   - 添加约束条件，包括居民迁入、地块占用、院落腾空、面积和采光补偿，以及总成本限制。

3. **模型求解**
   - 利用 PuLP 求解混合整数线性规划模型，通过迭代计算确定最优搬迁方案和院落腾空状态。
   - 确保结果在预算内并平衡多目标优先级。

4. **结果整理与展示**
   - 提取搬迁方案（$x_{h,n}$）、腾空院落（$y_k$）、总成本、十年期租金收入及净收益。
   - 通过表格和图形展示腾空院落分布及毗邻关系，评估优化效果。

#### 求解结果

通过上述步骤，得到以下结果：

**表 1：搬迁方案求解结果（部分）**

| 迁出地块ID | 迁入地块ID | 搬迁成本（万元） |
|------------|------------|------------------|
| 14         | 98         | 14.88            |
| 18         | 357        | 17.40            |
| 29         | 233        | 8.184            |
| 30         | 35         | 18.12            |
| 31         | 246        | 22.08            |
| 34         | 143        | 16.68            |
| 38         | 237        | 29.64            |
| 39         | 10         | 9.84             |
| 40         | 264        | 33.735           |
| 41         | 484        | 17.784           |

![图 7 腾空院落分布及毗邻关系](assets/腾空院落分布图.png)

图 7 展示了腾空院落的分布及其毗邻关系，直观呈现优化结果，便于决策者评估搬迁方案的实际效果。

### 问题三：性价增益拐点分析模型的建立与求解

#### 解题思路

基于问题一和问题二的搬迁补偿和决策模型，问题三要求分析搬迁过程中的性价增益拐点，即考察性价比 $ m $（定义为十年累计租金增量与实际搬迁投入的比值）是否存在下降点。为此，我们构建综合模型，通过优化搬迁方案并分析不同搬迁规模下的 $ m $ 值，确定拐点并提供相应的搬迁方案和经济分析。解题思路包括以下关键步骤：

​      1.**数据准备**：利用问题一和问题二的数据，整理地块、居民和院落信息，计算每个搬迁方案的成本和租金增量。

​      2.**优化建模**：基于线性规划，优化搬迁方案，在不同预算水平下计算 $ m $ 值。

​      3.**拐点分析**：通过参数扫描和可视化，分析 $ m $ 随搬迁成本变化的趋势，识别拐点。

​      4.**结果输出**：若存在拐点，提供具体搬迁方案；若无拐点，讨论调整 $ m $ 阈值后的情况。

#### 模型建立

性价增益拐点分析模型综合考虑硬性约束和优化目标，为搬迁决策提供科学依据。以下为模型的详细建立过程：

1. **决策变量**
   - **$ x_{h,n} $**: 二进制变量，表示居民 $ h $ 是否迁入地块 $ n $。若迁入，则 $ x_{h,n} = 1 $；否则，$ x_{h,n} = 0 $。
   - **$ y_k $**: 二进制变量，表示院落 $ k $ 是否腾空。若腾空，则 $ y_k = 1 $；否则，$ y_k = 0 $。
   - **$ C $**: 搬迁预算（万元），作为控制搬迁规模的参数。
   - **$ m $**: 性价比，定义为：$m = \text{十年累计租金增量} / \text{实际搬迁投入}$

2. **其他参数**
   
   - **$ A_{\text{old},h} $**: 居民 $ h $ 原地块面积（㎡）。
   - **$ A_n $**: 迁入地块 $ n $ 的面积（㎡）。
   - **$ r_n $**: 地块 $ n $ 的基础日租金（元/㎡·天），根据朝向取值：南/北为 15，东/西为 8，整院为 30，毗邻整院上浮 20%。
   - **$ c^{\text{comm}} $**: 每户沟通协调费（万元），为 3。
   - **$ c_h^{\text{reno}} $**: 居民 $ h $ 的修缮补偿（万元），上限 20。
   - **$ S_k $**: 院落 $ k $ 的总面积（㎡）。
   - **$ A_{k\ell} $**: 院落 $ k $ 与 $ \ell $ 的毗邻关系（1 表示毗邻，0 表示不毗邻）。
   
3. **目标函数**
   在每个预算 $ C $ 下，优化目标为最大化腾空院落数量：
   $$
   \text{maximize} \quad \sum_k y_k
   $$

4. **约束条件**
   - **每户居民至多迁入一个地块**：
     $$
     \sum_n x_{h,n} \leq 1, \quad \forall h
     $$
   - **每个地块至多被一个居民占用**：
     $$
     \sum_h x_{h,n} \leq 1, \quad \forall n
     $$
   - **院落腾空条件**：院落 $ k $ 腾空需所有居民迁出：
     $$
     y_k \leq 1 - \sum_{h \in k} \sum_n x_{h,n}, \quad \forall k
     $$
   - **面积约束**：
     $$
     A_{\text{old},h} \leq \sum_n A_n x_{h,n} \leq 1.3 \times A_{\text{old},h}, \quad \forall h
     $$
   - **采光约束**：新地块采光不低于原地块（南/北 = 3，东 = 2，西 = 1）：
     $$
     \sum_n r_n x_{h,n} \geq r_{\text{old},h}, \quad \forall h
     $$
   - **预算约束**：
     $$
     \sum_h \sum_n x_{h,n} (c^{\text{comm}} + c_h^{\text{reno}} + c_h^{\text{area}} + c_h^{\text{time}}) \leq C
     $$
     其中，$ c_h^{\text{area}} $ 为面积补偿损失，$ c_h^{\text{time}} $ 为迁出迁入各 4 个月的停租损失。

5. **性价比计算**
   - **搬迁成本**：
     $$
     \text{实际搬迁投入} = \sum_h \sum_n x_{h,n} (c^{\text{comm}} + c_h^{\text{reno}} + c_h^{\text{area}} + c_h^{\text{time}})
     $$
   - **租金增量**：考虑整院及毗邻效应，十年累计租金增量为：
     $$
     \text{十年累计租金增量} = \sum_k y_k S_k \cdot 365 \cdot 10 \cdot (30 + 0.2 \cdot 30 \cdot \sum_\ell A_{k\ell} y_\ell) / 10000
     $$
   - **性价比**：
     $$
     m = \frac{\text{十年累计租金增量}}{\text{实际搬迁投入}}
     $$

#### 求解步骤

1. **数据准备**
   - 加载地块、居民和院落数据，整理搬迁候选方案。
   - 计算每个搬迁组合的成本和租金增量。

2. **优化模型求解**
   - 在预算 $ C $ 从 0 逐步增加至最大可能成本，求解最大化腾空院落数量的模型。
   - 记录每个 $ C $ 对应的搬迁方案、成本和租金增量。

3. **性价比计算**
   - 根据租金增量和搬迁成本，计算 $ m $ 值。
   - 分析 $ m $ 随 $ C $ 变化的趋势。

4. **拐点识别**
   - 绘制 $ m $ 与 $ C $ 的关系曲线，识别 $ m $ 先升后降的峰值点（拐点）。
   - 若无拐点，调整 $ m $ 阈值并重新分析。

#### 求解结果

通过模型求解，得到以下结果：

- 在预算 $ C = 859.56 $ 万元时，性价比 $ m $ 达到最大值 147.31。整体来看，$ m $ 随 $ C $ 增加而下降，在要求 $ m \leq 20 $ 时无拐点，但 $ m = 147.31 $ 为最大值。具体结果如下：
  - **最佳 $ m $**：147.31
  - **成本上限**：859.56 万元
  - **搬迁总成本**：833.19 万元
  - **腾空院落**：75 个（为开发商提供充足开发空间）
  - **搬迁组合**：25 个（在预算内实现搬迁效率最大化）

**表 1：部分搬迁方案**

| 迁出地块ID | 迁入地块ID | 搬迁成本（万元） |
|------------|------------|------------------|
| 14         | 98         | 14.88            |
| 18         | 357        | 17.40            |
| 29         | 233        | 8.18             |
| 30         | 35         | 18.12            |

**敏感性分析**： 
调整预算区间分割点数发现，点数越多（区间等分越细），初始 $ m $ 值越大；点数较少时，$ m $ 值较小。这表明模型对参数敏感性较强，但迁出和迁入地块方案保持稳定。建议进一步采用遗传算法、模拟退火算法或蚁群算法优化模型，以提高鲁棒性和精度。

![$ m $ 值与成本关系曲线](assets/m_vs_cost_1.png)

​                                                **图 1：$ m $ 值与成本关系曲线**

图 1 显示，$ m $ 在 $ C = 2148.90 $ 万元时达到峰值，随后下降，拐点清晰可见。

![$ m $ 值与成本关系曲线](assets/m_vs_cost_2.png)

​                                                **图 2：$ m $ 值与成本关系曲线（调整参数后)**

### 问题四：平移置换决策软件框架的设计方案

#### 设计思路

为满足老城区平移置换的实际需求，我们设计了一个功能全面、操作简便且具备高可扩展性的软件框架。该框架整合了问题一的搬迁补偿模型、问题二的整院面积最大化搬迁决策模型以及问题三的性价增益拐点分析模型，通过模块化设计实现数据输入、模型计算和结果可视化的无缝衔接。

#### 软件框架整体结构

软件框架由若干核心模块组成，各模块功能明确且协作高效，确保系统整体运行流畅。

![软件框架结构](assets/app_1.png)

1. **数据输入模块**
   该模块负责收集用户提供的地块信息、居民信息和预算参数等基础数据。支持两种输入方式：通过外部文件（如 CSV 或 Excel）导入，或通过图形用户界面（GUI）手动输入/编辑数据。为提升用户体验，界面提供模板和数据校验功能，确保输入格式正确。例如，若输入地块面积为负值，系统将提示用户更正。

   ![数据输入界面](assets/app_2.png)
   ![数据校验界面](assets/app_3.png)

2. **模型计算模块**
   作为软件核心，该模块集成了问题一、问题二和问题三的数学模型。根据用户选择的任务，调用相应的模型进行计算。为处理复杂的优化问题（如线性规划和混合整数线性规划），模块使用 PuLP 库或更高效的 Gurobi 求解器。计算过程自动优化目标函数并满足约束条件，实现自动化求解。

   ![模型计算流程](assets/app_4.png)
   ![优化求解界面](assets/app_5.png)

3. **可视化模块**
   该模块将复杂的计算结果转化为直观的图表，如地块分布图、搬迁路径图或性价比变化曲线。使用 Python 的 Matplotlib 或 Plotly 库生成交互式可视化，用户可通过鼠标操作放大图表或查看具体数据点，提升结果的可理解性。

4. **结果预览模块**
   该模块用于展示所有计算结果和输出数据，支持将结果保存为多种格式（如 CSV、JSON）。用户可通过界面浏览详细的搬迁方案、腾空院落列表及经济指标。

   ![结果预览界面](assets/app_6.png)

#### 人工输入参数

软件运行需用户提供关键参数，可通过图形界面或配置文件（config.json）设置。以下为参数详情、来源及作用：

1. **地块信息**
   - **参数**：地块编号（ID）、院落编号（院落 ID）、地块面积、朝向（南、北、东、西）、是否有住户。
   - **来源**：从附件一的街区地块数据文件获取，或用户通过界面手动填写。
   - **作用**：提供搬迁决策的基础数据。若无现成数据，软件提供默认模板（如包含 10 个地块的示例表格）。

2. **居民偏好**
   - **参数**：面积比例阈值（$\theta_h^A$，如最低 80% 原面积）、采光等级阈值（$\theta_h^P$，如南向优先）、修缮补偿上限（$\theta_h^R$，如 20 万元）。
   - **来源**：用户根据居民需求设定，默认值存储在 config.json（如 $\theta_h^A = 0.8$）。  
   - **作用**：反映居民对搬迁地块的最低要求，确保方案满足个性化需求。

3. **预算参数**
   - **参数**：保底成本（$B_{\text{base}}$，默认 2000 万元）、备用金上限（$B_{\text{reserve}}$，默认 600 万元）。  
   - **来源**：用户通过界面输入或从配置文件读取。
   - **作用**：限定搬迁总成本，用户可灵活调整（如总预算改为 3000 万元）。

4. **成本参数**
   - **参数**：沟通协调费（$c^{\text{comm}}$，默认每户 3 万元）、修缮费上限（默认 20 万元）、租金标准（南/北 15 元/㎡·天，东/西 8 元/㎡·天）、停租天数（默认 120 天）。
   - **来源**：用户根据实际情况设定，默认值在配置文件中。
   - **作用**：影响搬迁成本计算，用户可调整（如租金标准改为 20 元/㎡·天）。

5. **图像文件**
   - **参数**：街区地块分布图像文件路径（如 B.jpg）。
   - **来源**：用户上传。
   - **作用**：作为可视化背景图，叠加计算结果（如标记腾空地块）。

6. **模型选择**
   - **参数**：运行模型（问题一、问题二或问题三）。
   - **来源**：用户通过界面下拉菜单选择。
   - **作用**：确定调用哪个计算模块。

7. **优化参数**
   - **参数**：目标函数权重（如腾空院落数权重 10，连通性权重 5）、邻接阈值（adj_threshold，默认 100 米）。  
   - **来源**：配置文件或用户界面自定义。
   - **作用**：控制优化优先级和计算精度，用户可调整（如连通性权重改为 8）。

#### 问题二的可视化智能计算

问题二旨在最大化腾空院落数量、连通性、总面积，同时最小化搬迁户数，预算限制为 2600 万元。以下为实现步骤：

1. **输入数据**
   
   - 加载地块信息（面积、朝向）、居民信息（最低面积要求）、预算参数（2600 万元上限）及成本参数（沟通费、修缮费等）。
   
2. **模型计算**
   - 调用问题二的混合整数线性规划模型（参考代码 question2_3.py）。优化目标函数为：
     $$
     \text{maximize} \quad 10 \cdot \sum_k y_k + 5 \cdot \sum_k \sum_\ell A_{k\ell} y_k y_\ell + 0.01 \cdot \sum_k S_k y_k - 0.1 \cdot \sum_h \sum_n x_{h,n}
     $$
     其中，$y_k$ 表示院落 $k$ 是否腾空，$A_{k\ell}$ 为邻接矩阵，$S_k$ 为院落面积，$x_{h,n}$ 表示居民 $h$ 是否迁入地块 $n$。
   - 约束包括总成本不超过 2600 万元、每位居民至多迁入一个地块、院落腾空需所有居民迁出。

3. **计算结果**
   - 输出搬迁方案（居民迁入地块）、腾空院落列表、总成本及十年租金收入。例如，“居民 A 从地块 1 迁至地块 5，腾空院落 2，总成本 2500 万元，租金收入 3000 万元”。

4. **可视化**
   - **搬迁方案图**：使用 Matplotlib 绘制地图，箭头表示居民迁移路径（如地块 1 至地块 5）。  
   - **腾空院落图**：在背景图（B.jpg）上高亮腾空院落，用不同颜色标记连通院落群组。

#### 问题三的可视化智能计算

问题三分析性价比 $m = \frac{\text{十年累计租金增量}}{\text{实际搬迁投入}}$ 的拐点，无成本上限，要求 $m \geq 20$。以下为实现步骤：

1. **输入数据**
   - 加载地块信息、居民信息和成本参数，租金增量基于地块朝向和面积计算，无预算上限。

2. **模型计算**
   - 调用问题三的性价比分析模型（参考代码 question3.py）。通过逐步增加预算 $C$（从 0 开始，每次增 100 万元），计算每次的搬迁方案、租金增量和 $m$ 值，寻找最大 $m$ 或拐点（$m$ 开始下降的点）。

3. **计算结果**
   - 输出 $m$ 随预算变化的数据、最优 $m$ 时的搬迁方案、腾空院落、总成本和收益。例如，“预算 4000 万元时，$m = 25$，腾空 5 个院落，租金增量 1 亿元”。

4. **可视化**
   - **$m$ 值曲线图**：使用 Plotly 绘制 $m$ 随成本 $C$ 变化的曲线，标记最大 $m$ 和拐点。  
   - **租金增量与成本关系图**：展示租金增量随成本的增长趋势。  
   - **最佳方案详情表**：列出最优 $m$ 时的搬迁组合、腾空院落和经济指标，如“搬迁 10 户，腾空院落 3、5、7，总成本 3500 万元”。

## 模型的评价与改进

### 计算性能评估

计算性能是优化模型的重要评价指标，特别是在处理大规模城市规划问题时。对于问题二的计算性能，我们使用 PuLP 库和 CBC 求解器求解混合整数线性规划 (MILP) 模型。对于包含 113 位居民和 371 个空置地块的实例，求解器在约 3 秒内找到最优解，优度间隙为 0%，表明解是全局最优。这显示了模型在给定规模下的计算效率较高。对于问题一和问题三的性能，虽然具体时间未详细记录，但问题一涉及遍历空置地块计算补偿，问题三涉及预算逐步增加的迭代计算，预计计算时间随实例规模增加而增长。未来扩展方面，对于更大规模问题（如更多居民或地块），当前模型可能面临计算瓶颈，需考虑启发式或元启发式算法以提高效率。

### 解的质量分析

解的质量直接反映模型是否有效实现其目标，以下逐一分析各问题的解。

#### 问题一：搬迁补偿模型

该模型生成满足面积（$A_{old} \leq A_{new} \leq 1.3A_{old}$）、采光（南/北 > 东/西）和修缮补偿（不超过 20 万元）硬约束的补偿方案。我们验证了每个居民至少有一个候选地块符合条件，并考虑了附加因素如街道距离和房屋密度。结果显示，补偿值分布合理，反映了地块和居民情况的多样性，增强了居民满意度的可能性。

#### 问题二：最大化腾空院落面积

模型优化了腾空院落数量、连通性、总面积和搬迁户数，预算限制为 2600 万元。求解结果腾空了 85 个院落，其中 35 个相邻，腾空总面积为 17848 平方米，搬迁户数为 48。这些结果符合多目标优化的优先级，显示模型在平衡不同目标方面的有效性。

#### 问题三：性价比增益拐点分析

该模型分析了性价比 $m = \text{十年累计租金增量} / \text{实际搬迁投入}$，通过逐步增加预算计算 $m$ 的变化。结果显示，$m$ 在预算 859.56 万元时达到最大值 147.31，此时搬迁 23 户，腾空 75 个院落，总成本为 833.19 万元，十年租金增量为 1227338050.00 元。这为决策者提供了投资回报最大化的参考点。

### 敏感性分析与鲁棒性

敏感性分析有助于评估模型对参数变化的反应，反映其鲁棒性。对于预算敏感性，我们对问题二的预算进行 ±10% 变化，观察目标函数的变化。预算增加 10% 时，腾空院落数不变；减少 10% 时，腾空院落数同样不变。这表明模型对预算约束不敏感，可能是由于其他参数设置不够恰当，但切实提供了一种可解决实际问题的高效能算法。其他参数方面，如目标函数中权重的变化（腾空院落数权重 10，连通性权重 5）可能影响解的优先级，需进一步分析权重的合理性。鲁棒性讨论中，模型假设数据稳定（如地块面积和采光分数不变），但实际中可能存在不确定性，未来可加入随机规划或情景分析以增强鲁棒性。此外，模型假设所识别的聚类中心的坐标与原题顺序直接对应（从 1-107 或 1-484），这在现实中不太可能。但基于这种处理方式，可以计算各个院落的临近性。房屋地块的临近性、搬迁前后的距离成本以及交通成本十分重要。现实情况中，可对房屋 ID 和坐标进行一一映射，暂时这种处理方式是可接受的。

### 约束满足与实际应用

所有模型均确保满足硬约束，如面积、采光和预算限制。我们验证了求解结果中无违反约束的情况，这保证了模型的实际可行性。实际应用潜力方面，模型输出（如搬迁方案、腾空院落分布）可直接用于城市规划，支持开发商提升开发价值，同时兼顾文化传承和居民生活品质。然而，模型依赖标准化数据和假设（如房屋颜色分类稳定），可能受限于实际数据质量。局限性在于，当前模型未充分考虑居民的动态偏好或长期社会影响，未来需整合更多实地调研数据以提高现实性。

### 模型的优点

模型具有以下优点：
- **系统性**：通过数学优化确保解的全局最优，超越传统手动规划的局限。
- **多目标平衡**：问题二采用加权综合方法，平衡了腾空数量、连通性和成本，满足复杂决策需求。
- **灵活性**：模型参数（如预算、权重）可根据实际需求调整配置，适配不同规划场景。
- **高效能算法**：通过首先计算候选方案再筛选优化，计算时间复杂度从 $O(n^2)$ 降低到 $O(n)$。
- **可视化支持**：结合问题四的软件框架，模型结果可通过图表（如搬迁路径、$m$ 曲线）直观展示，便于决策者理解。

### 模型的缺点

模型存在以下缺点：
- **空间位置和 ID 的依赖**：假设坐标和 ID 按顺序从 1 到 n 对应，若图像识别后的坐标乱序，模型可能失效。
- **居民偏好简化**：未深入考虑居民的心理价位或长期满意度，可能影响实际执行效果。
- **单一情景分析**：未充分探讨不确定性（如政策变化、居民异议）对模型的影响。

### 模型的改进

基于上述缺点，提出以下改进方向：
- **计算效率**：引入遗传算法、模拟退火等启发式方法，处理更大规模问题，减少求解时间。
- **数据增强**：整合更多实地数据，如居民问卷调查结果，细化心理价位和舒适度评分。
- **不确定性建模**：采用随机规划或情景分析，评估政策变化或数据噪声对模型的影响。
- **动态优化**：开发动态模型，考虑居民搬迁过程中的反馈和调整，增强长期适用性。
- **软件集成**：进一步完善问题四的决策支持系统，支持交互式优化和实时可视化，方便规划者使用。